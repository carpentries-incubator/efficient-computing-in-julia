<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Efficient Computing in Julia: Type Stability</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/100-introduction-performance.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Efficient Computing in Julia
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Efficient Computing in Julia
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Efficient Computing in Julia
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 61%" class="percentage">
    61%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 61%" aria-valuenow="61" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/100-introduction-performance.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="020-getting-started.html">1. Getting Started</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="030-julia-basics.html">2. Introduction to Julia</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="040-dispatch-and-types.html">3. Types and Dispatch</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="060-simulating-solar-system.html">4. Simulating the Solar System</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="070-pkg.html">5. Packages and environments</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="080-package-development.html">6. Package development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="090-best-practices.html">7. Best practices</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Type Stability
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#type-stability">Type stability</a></li>
<li><a href="#functions-in-structs">Functions in structs</a></li>
<li><a href="#multi-threading-and-type-stability">Multi-threading and type stability</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="120-allocations.html">9. Reducing allocations on the Logistic Map</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="130-value-types-and-ca.html">10. Value types: game of life</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="140-threads-async-and-tasks.html">11. Threads, ASync and Tasks</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="170-gpu-programming.html">12. GPU Programming</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="180-cool-libraries.html">13. Recap and Recommended libraries</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="a01-collatz.html">14. Appendix: Iterators and type stability</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="090-best-practices.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="120-allocations.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="090-best-practices.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Best practices
        </a>
        <a class="chapter-link float-end" href="120-allocations.html" rel="next">
          Next: Reducing allocations...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Type Stability</h1>
        <p>Last updated on 2025-02-09 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/100-introduction-performance.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What is type stability?</li>
<li>Why is type stability so important for performance?</li>
<li>What is the origin of type unstable code? How can I prevent it?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn to diagnose type stability using <code>@code_warntype</code>
and <code>@profview</code>
</li>
<li>Understand how and why to avoid global mutable variables.</li>
<li>Analyze the problem when passing functions as members of a
struct.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>In this episode we will look into <strong>type stability</strong>, a
very important topic when it comes to writing efficient Julia. We will
first show some small examples, trying to explain what type stability
means and how you can create code that is not type stable. Then we will
have two examples: one computing the growth of a coral reef under
varying sea level, the other computing the value of <span class="math inline">\(\pi\)</span> using the Chudnovsky algorithm.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span></code></pre>
</div>
<section><h2 class="section-heading" id="type-stability">Type stability<a class="anchor" aria-label="anchor" href="#type-stability"></a></h2>
<hr class="half-width"><p>If types cannot be inferred at compile time, a function cannot be
entirely compiled to machine code. This means that evaluation will be
slow as molasses. One example of a type instability is when a function’s
return type depends on run-time values:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">safe_inv</span>(x<span class="op">::</span><span class="dt">T</span>) <span class="kw">where</span> {T}</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">==</span> <span class="fu">zero</span>(T)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="cn">nothing</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="fu">one</span>(T) <span class="op">/</span> x</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">safe_inv</span>(<span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>)</span></code></pre>
</div>
<p>In this case we may observe that the induced type is
<code>Union{Nothing, T}</code>. If we run <code>@code_warntype</code> we
can see the yellow highlighting of the union type. Having union-types
can be hint that the compiler is in uncertain territory. However, union
types are at the very core of how Julia approaches iteration and
therefore for-loops, so usually this will not lead to run-time
dispatches being triggered.</p>
<p>The situation is much worse when mutable globals are in place.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">replace_x</span>(f, vs) <span class="op">=</span> [(<span class="fu">f</span>(v) ? x <span class="op">:</span> v) for v <span class="kw">in</span> vs]</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="fu">replace_x</span>((<span class="op">&lt;</span>)(<span class="fl">0</span>), <span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">replace_x</span>((<span class="op">&lt;</span>)(<span class="fl">0</span>), <span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>)</span></code></pre>
</div>
<p>We can follow this up with:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>x <span class="op">=</span> <span class="st">"sloppy code!"</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">replace_x</span>((<span class="op">&lt;</span>)(<span class="fl">0</span>), <span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>)</span></code></pre>
</div>
<div id="use-parameters-or-const" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="use-parameters-or-const" class="callout-inner">
<h3 class="callout-title">Use parameters or <code>const</code>
</h3>
<div class="callout-content">
<p>Change the definition of <code>replace_x</code> by passing
<code>x</code> as a parameter. Change the definition of <code>x</code>
to a constant using <code>const</code>. Time the result against the type
unstable version.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="functions-in-structs">Functions in structs<a class="anchor" aria-label="anchor" href="#functions-in-structs"></a></h2>
<hr class="half-width"><p>Every function has its own unique type. This can be a problem when we
want to get some functional user input. The following computes the
sedimentation history of a coral reef, following a paper by Bosscher
&amp; Schlager 1992:</p>
<p><span class="math display">\[\frac{\partial y}{\partial t} = g_m
\tanh \left(\frac{I_0 \exp(-kw)}{I_k}\right),\]</span></p>
<p>where <span class="math inline">\(g_m\)</span> is the maximum growth
rate, <span class="math inline">\(I_0\)</span> is the insolation (light
intensity at sea-level), <span class="math inline">\(I_k\)</span> the
saturation intensity, <span class="math inline">\(k\)</span> the
extinction coefficient and <span class="math inline">\(w\)</span> the
waterdepth, being <span class="math inline">\(sl(t) - y +
\sigma*t\)</span>, where <span class="math inline">\(sl(t)\)</span> is
the sea level and <span class="math inline">\(\sigma\)</span> is the
subsidence rate. The model uses the <span class="math inline">\(\tanh\)</span> function to interpolate between
maximum growth and zero growth, modified by the exponential extinction
of sun light as we go deeper into the water. Details don’t matter much,
the point being that we’d like to be able to specify the sea level as an
input parameter in functional form.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="pp">@kwdef</span> <span class="kw">struct</span> Input</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="st">"The sea level as a function of time"</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    sea_level <span class="op">=</span> _ <span class="op">-&gt;</span> <span class="fl">0.0</span>u<span class="st">"m"</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    <span class="st">"Maximum growth rate of the coral, in m/Myr"</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    maximum_growth_rate<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"m/Myr"</span>) <span class="op">=</span> <span class="fl">0.2</span>u<span class="st">"mm/yr"</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="st">"The light intensity at which maximum growth is attained, in W/m^2"</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    saturation_intensity<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"W/m^2"</span>) <span class="op">=</span> <span class="fl">50.0</span>u<span class="st">"W/m^2"</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    <span class="st">"The rate at which growth rate drops every meter of water depth, in 1/m"</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    extinction_coefficient<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"m^-1"</span>) <span class="op">=</span> <span class="fl">0.05</span>u<span class="st">"m^-1"</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    <span class="st">"The light intensity of the Sun, in W/m^2"</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    insolation<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"W/m^2"</span>) <span class="op">=</span> <span class="fl">400.0</span>u<span class="st">"W/m^2"</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>    <span class="st">"Subsidence rate is the rate at which the plateau drops, in m/Myr"</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>    subsidence_rate<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"m/Myr"</span>) <span class="op">=</span> <span class="fl">50.0</span>u<span class="st">"m/Myr"</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="kw">function</span> <span class="fu">growth_rate</span>(input)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>    sea_level <span class="op">=</span> input.sea_level</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">df</span>(y, t)</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>        <span class="co"># w = input.sea_level(t) - y + input.subsidence_rate * t</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>        w <span class="op">=</span> <span class="fu">sea_level</span>(t) <span class="op">-</span> y <span class="op">+</span> input.subsidence_rate <span class="op">*</span> t</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>        g_m <span class="op">=</span> input.maximum_growth_rate</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>        I_0 <span class="op">=</span> input.insolation</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>        I_k <span class="op">=</span> input.saturation_intensity</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>        k <span class="op">=</span> input.extinction_coefficient</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>        w <span class="op">&gt;</span> <span class="fl">0</span>u<span class="st">"m"</span> ? g_m <span class="op">*</span> <span class="fu">tanh</span>(I_0 <span class="op">*</span> <span class="fu">exp</span>(<span class="op">-</span>k <span class="op">*</span> w) <span class="op">/</span> I_k) <span class="op">:</span> <span class="fl">0.0</span>u<span class="st">"m/Myr"</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">forward_euler</span>(df, y0<span class="op">::</span><span class="dt">T</span>, t) <span class="kw">where</span> {T}</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{T}</span>(<span class="cn">undef</span>, <span class="fu">length</span>(t) <span class="op">+</span> <span class="fl">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    result[<span class="fl">1</span>] <span class="op">=</span> y <span class="op">=</span> y0</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    dt <span class="op">=</span> <span class="fu">step</span>(t)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(t)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>        y <span class="op">=</span> y <span class="op">+</span> <span class="fu">df</span>(y, t[i]) <span class="op">*</span> dt</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        result[i<span class="op">+</span><span class="fl">1</span>] <span class="op">=</span> y</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">let</span> input <span class="op">=</span> <span class="fu">Input</span>(sea_level<span class="op">=</span>t<span class="op">-&gt;</span><span class="fl">20.0</span>u<span class="st">"m"</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="fl">2</span>π<span class="op">*</span>t<span class="op">/</span><span class="fl">200</span>u<span class="st">"kyr"</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    initial_topography <span class="op">=</span> (<span class="fl">0.0</span><span class="op">:-</span><span class="fl">1.0</span><span class="op">:-</span><span class="fl">100.0</span>)u<span class="st">"m"</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">forward_euler</span>(<span class="fu">growth_rate</span>(input), y0, (<span class="fl">0.0</span><span class="op">:</span><span class="fl">0.001</span><span class="op">:</span><span class="fl">1.0</span>)u<span class="st">"Myr"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        <span class="cf">for</span> y0 <span class="kw">in</span> initial_topography) <span class="op">.-</span> <span class="fl">1.0</span>u<span class="st">"Myr"</span> <span class="op">*</span> input.subsidence_rate</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"y0"</span>, ylabel<span class="op">=</span><span class="st">"y"</span>, xreversed<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="fu">eachrow</span>(result[<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">:</span><span class="kw">end</span>,<span class="op">:</span>])</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, initial_topography<span class="op">/</span>u<span class="st">"m"</span>, r<span class="op">/</span>u<span class="st">"m"</span>, color<span class="op">=:</span>black)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    fig</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="cf">end</span></span></code></pre>
</div>
<p>What is wrong with this code?</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">let</span> input <span class="op">=</span> <span class="fu">Input</span>(sea_level<span class="op">=</span>t<span class="op">-&gt;</span><span class="fl">20.0</span>u<span class="st">"m"</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="fl">2</span>π<span class="op">*</span>t<span class="op">/</span><span class="fl">200</span>u<span class="st">"kyr"</span>)),</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    y0 <span class="op">=</span> <span class="op">-</span><span class="fl">50.0</span>u<span class="st">"m"</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="pp">@code_warntype</span> <span class="fu">forward_euler</span>(<span class="fu">growth_rate</span>(input), y0, (<span class="fl">0.0</span><span class="op">:</span><span class="fl">0.001</span><span class="op">:</span><span class="fl">1.0</span>)u<span class="st">"Myr"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>The function in <code>Input</code> is untyped. We could try to type
the argument with a type parameter, but that doesn’t work so well with
<code>@kwdef</code> (we’d have to redefine the constructor). The problem
is also fixed if we recapture the <code>sea_level</code> parameter in
the local scope of the <code>growth_rate</code> function, see <a href="https://docs.julialang.org/en/v1/manual/performance-tips/#man-performance-captured" class="external-link">Performance
Tips</a>.</p>
<div id="fix-the-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="fix-the-code" class="callout-inner">
<h3 class="callout-title">Fix the code</h3>
<div class="callout-content">
<p>Modify the <code>growth_rate</code> function such that the
<code>sea_level</code> look-up becomes type stable. Assign the parameter
to a value with local scope.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">growth_rate</span>(input)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    sea_level <span class="op">=</span> input.sea_level</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">df</span>(y, t)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>        w <span class="op">=</span> <span class="fu">sea_level</span>(t) <span class="op">-</span> y <span class="op">+</span> input.subsidence_rate <span class="op">*</span> t</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>        g_m <span class="op">=</span> input.maximum_growth_rate</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>        I_0 <span class="op">=</span> input.insolation</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>        I_k <span class="op">=</span> input.saturation_intensity</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>        k <span class="op">=</span> input.extinction_coefficient</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>        w <span class="op">&gt;</span> <span class="fl">0</span>u<span class="st">"m"</span> ? g_m <span class="op">*</span> <span class="fu">tanh</span>(I_0 <span class="op">*</span> <span class="fu">exp</span>(<span class="op">-</span>k <span class="op">*</span> w) <span class="op">/</span> I_k) <span class="op">:</span> <span class="fl">0.0</span>u<span class="st">"m/Myr"</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">let</span> input <span class="op">=</span> <span class="fu">Input</span>(sea_level<span class="op">=</span>t<span class="op">-&gt;</span><span class="fl">20.0</span>u<span class="st">"m"</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="fl">2</span>π<span class="op">*</span>t<span class="op">/</span><span class="fl">200</span>u<span class="st">"kyr"</span>)),</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    y0 <span class="op">=</span> <span class="op">-</span><span class="fl">50.0</span>u<span class="st">"m"</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="pp">@code_warntype</span> <span class="fu">forward_euler</span>(<span class="fu">growth_rate</span>(input), y0, (<span class="fl">0.0</span><span class="op">:</span><span class="fl">0.001</span><span class="op">:</span><span class="fl">1.0</span>)u<span class="st">"Myr"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="multi-threading-and-type-stability">Multi-threading and type stability<a class="anchor" aria-label="anchor" href="#multi-threading-and-type-stability"></a></h2>
<hr class="half-width"><p>Here we have an algorithm that computes the value of π to high
precision. We can make this algorithm parallel by recursively calling
<code>Threads.@spawn</code>, and then <code>fetch</code> on each task.
Unfortunately the return type of <code>fetch</code> is never known at
compile time. We can keep the type instability localized by declaring
the return types.</p>
<p>The following algorithm is <a href="https://en.wikipedia.org/wiki/Chudnovsky_algorithm" class="external-link">copy-pasted
from Wikipedia</a>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">binary_split_1</span>(a, b)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    Pab <span class="op">=</span> <span class="fu">-</span>(<span class="fl">6</span><span class="op">*</span>a <span class="op">-</span> <span class="fl">5</span>)<span class="fu">*</span>(<span class="fl">2</span><span class="op">*</span>a <span class="op">-</span> <span class="fl">1</span>)<span class="fu">*</span>(<span class="fl">6</span><span class="op">*</span>a <span class="op">-</span> <span class="fl">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    Qab <span class="op">=</span> <span class="fl">10939058860032000</span> <span class="op">*</span> a<span class="op">^</span><span class="fl">3</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    Rab <span class="op">=</span> Pab <span class="op">*</span> (<span class="fl">545140134</span><span class="op">*</span>a <span class="op">+</span> <span class="fl">13591409</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="cf">return</span> Pab, Qab, Rab</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="fu">setprecision</span>(<span class="fl">20</span>, base<span class="op">=</span><span class="fl">30</span>) <span class="cf">do</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    _, q, r <span class="op">=</span> <span class="fu">binary_split_1</span>(<span class="fu">big</span>(<span class="fl">1</span>), <span class="fu">big</span>(<span class="fl">2</span>))</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    (<span class="fl">426880</span> <span class="op">*</span> <span class="fu">sqrt</span>(<span class="fu">big</span>(<span class="fl">10005.0</span>)) <span class="op">*</span> q) <span class="op">/</span> (<span class="fl">13591409</span><span class="op">*</span>q <span class="op">+</span> r)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co"># The last few digits are wrong... check</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="fu">setprecision</span>(<span class="fl">20</span>, base<span class="op">=</span><span class="fl">30</span>) <span class="cf">do</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    <span class="cn">π</span> <span class="op">|&gt;</span> <span class="dt">BigFloat</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co"># The algorithm refines by recursive binary splitting</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co"># Recursion is fine here: we go 2logN deep.</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="kw">function</span> <span class="fu">binary_split</span>(a, b)</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>    <span class="cf">if</span> b <span class="op">==</span> a <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>        <span class="fu">binary_split_1</span>(a, b)</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>        m <span class="op">=</span> <span class="fu">div</span>(a <span class="op">+</span> b, <span class="fl">2</span>)</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>        Pam, Qam, Ram <span class="op">=</span> <span class="fu">binary_split</span>(a, m)</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>        Pmb, Qmb, Rmb <span class="op">=</span> <span class="fu">binary_split</span>(m, b)</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>        </span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>        Pab <span class="op">=</span> Pam <span class="op">*</span> Pmb</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>        Qab <span class="op">=</span> Qam <span class="op">*</span> Qmb</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>        Rab <span class="op">=</span> Qmb <span class="op">*</span> Ram <span class="op">+</span> Pam <span class="op">*</span> Rmb</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>        <span class="cf">return</span> Pab, Qab, Rab</span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="kw">function</span> <span class="fu">chudnovsky</span>(n)</span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>    P1n, Q1n, R1n <span class="op">=</span> <span class="fu">binary_split</span>(<span class="fu">big</span>(<span class="fl">1</span>), n)</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>    <span class="cf">return</span> (<span class="fl">426880</span> <span class="op">*</span> <span class="fu">sqrt</span>(<span class="fu">big</span>(<span class="fl">10005.0</span>)) <span class="op">*</span> Q1n) <span class="op">/</span> (<span class="fl">13591409</span><span class="op">*</span>Q1n <span class="op">+</span> R1n)</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="fu">setprecision</span>(<span class="fl">10000</span>)</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">chudnovsky</span>(<span class="fu">big</span>(<span class="fl">20000</span>))</span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a><span class="co"># We can create a parallel version by spawning jobs. These are green threads.</span></span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a><span class="kw">function</span> <span class="fu">binary_split_td</span>(a<span class="op">::</span><span class="dt">T</span>, b<span class="op">::</span><span class="dt">T</span>) <span class="kw">where</span> {T}</span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>    <span class="cf">if</span> b <span class="op">==</span> a <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>        <span class="fu">binary_split_1</span>(a, b)</span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a>        m <span class="op">=</span> <span class="fu">div</span>(a <span class="op">+</span> b, <span class="fl">2</span>)</span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a>        t1 <span class="op">=</span> <span class="pp">@Threads</span>.spawn <span class="fu">binary_split_td</span>(a, m)</span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a>        t2 <span class="op">=</span> <span class="pp">@Threads</span>.spawn <span class="fu">binary_split_td</span>(m, b)</span>
<span id="cb12-53"><a href="#cb12-53" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" tabindex="-1"></a>        Pam, Qam, Ram <span class="op">=</span> <span class="fu">fetch</span>(t1)</span>
<span id="cb12-55"><a href="#cb12-55" tabindex="-1"></a>        Pmb, Qmb, Rmb <span class="op">=</span> <span class="fu">fetch</span>(t2)</span>
<span id="cb12-56"><a href="#cb12-56" tabindex="-1"></a>        </span>
<span id="cb12-57"><a href="#cb12-57" tabindex="-1"></a>        Pab <span class="op">=</span> Pam <span class="op">*</span> Pmb</span>
<span id="cb12-58"><a href="#cb12-58" tabindex="-1"></a>        Qab <span class="op">=</span> Qam <span class="op">*</span> Qmb</span>
<span id="cb12-59"><a href="#cb12-59" tabindex="-1"></a>        Rab <span class="op">=</span> Qmb <span class="op">*</span> Ram <span class="op">+</span> Pam <span class="op">*</span> Rmb</span>
<span id="cb12-60"><a href="#cb12-60" tabindex="-1"></a>        <span class="cf">return</span> Pab, Qab, Rab</span>
<span id="cb12-61"><a href="#cb12-61" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-62"><a href="#cb12-62" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-63"><a href="#cb12-63" tabindex="-1"></a></span>
<span id="cb12-64"><a href="#cb12-64" tabindex="-1"></a><span class="kw">function</span> <span class="fu">chudnovsky_td</span>(n)</span>
<span id="cb12-65"><a href="#cb12-65" tabindex="-1"></a>    P1n, Q1n, R1n <span class="op">=</span> <span class="fu">binary_split_td</span>(<span class="fu">big</span>(<span class="fl">1</span>), n)</span>
<span id="cb12-66"><a href="#cb12-66" tabindex="-1"></a>    <span class="cf">return</span> (<span class="fl">426880</span> <span class="op">*</span> <span class="fu">sqrt</span>(<span class="fu">big</span>(<span class="fl">10005.0</span>)) <span class="op">*</span> Q1n) <span class="op">/</span> (<span class="fl">13591409</span><span class="op">*</span>Q1n <span class="op">+</span> R1n)</span>
<span id="cb12-67"><a href="#cb12-67" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>The following may show why the parallel code isn’t faster yet.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">setprecision</span>(<span class="fl">10000</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">chudnovsky_td</span>(<span class="fu">big</span>(<span class="fl">20000</span>))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="pp">@profview</span> <span class="fu">chudnovsky_td</span>(<span class="fu">big</span>(<span class="fl">200000</span>))</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">chudnovsky_td</span>(<span class="fu">big</span>(<span class="fl">6</span>))</span></code></pre>
</div>
<ul><li>The red areas in the flame graph show type unstable code (marked
with <strong>run-time dispatch</strong>)</li>
<li>Yellow regions are allocations.</li>
<li>The same can be seen in the code, as a kind of histogram back
drop.</li>
</ul><p>The code is also inefficient because <code>poptask</code> is very
prominent. We can make sure that each task is a bit beefier by reverting
to the serial code at some point. Insert the following in
<code>binary_split_td</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>elseif b <span class="op">-</span> a <span class="op">&lt;=</span> <span class="fl">1024</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    <span class="fu">binary_split</span>(a, b)</span></code></pre>
</div>
<p>We can limit the type instability by changing the <code>fetch</code>
lines:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>Pam<span class="op">::</span><span class="dt">T</span>, Qam<span class="op">::</span><span class="dt">T</span>, Ram<span class="op">::</span><span class="dt">T </span><span class="op">=</span> <span class="fu">fetch</span>(t1)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>Pmb<span class="op">::</span><span class="dt">T</span>, Qmb<span class="op">::</span><span class="dt">T</span>, Rmb<span class="op">::</span><span class="dt">T </span><span class="op">=</span> <span class="fu">fetch</span>(t2)</span></code></pre>
</div>
<div id="rerun-the-profiler" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="rerun-the-profiler" class="callout-inner">
<h3 class="callout-title">Rerun the profiler</h3>
<div class="callout-content">
<p>Rerun the profiler and <code>@code_warntype</code>. Is the type
instability gone?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">binary_split_td</span>(a<span class="op">::</span><span class="dt">T</span>, b<span class="op">::</span><span class="dt">T</span>) <span class="kw">where</span> {T}</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    <span class="cf">if</span> b <span class="op">==</span> a <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>        <span class="fu">binary_split_1</span>(a, b)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    <span class="cf">elseif</span> b <span class="op">-</span> a <span class="op">&lt;=</span> <span class="fl">1024</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>        <span class="fu">binary_split</span>(a, b)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>        m <span class="op">=</span> <span class="fu">div</span>(a <span class="op">+</span> b, <span class="fl">2</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>        t1 <span class="op">=</span> <span class="pp">@Threads</span>.spawn <span class="fu">binary_split_td</span>(a, m)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>        t2 <span class="op">=</span> <span class="pp">@Threads</span>.spawn <span class="fu">binary_split_td</span>(m, b)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>        Pam<span class="op">::</span><span class="dt">T</span>, Qam<span class="op">::</span><span class="dt">T</span>, Ram<span class="op">::</span><span class="dt">T </span><span class="op">=</span> <span class="fu">fetch</span>(t1)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>        Pmb<span class="op">::</span><span class="dt">T</span>, Qmb<span class="op">::</span><span class="dt">T</span>, Rmb<span class="op">::</span><span class="dt">T </span><span class="op">=</span> <span class="fu">fetch</span>(t2)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>        </span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>        Pab <span class="op">=</span> Pam <span class="op">*</span> Pmb</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>        Qab <span class="op">=</span> Qam <span class="op">*</span> Qmb</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>        Rab <span class="op">=</span> Qmb <span class="op">*</span> Ram <span class="op">+</span> Pam <span class="op">*</span> Rmb</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>        <span class="cf">return</span> Pab, Qab, Rab</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Yes!</p>
</div>
</div>
</div>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>A good summary on type stability can be found in the following blog
post: - <a href="https://www.juliabloggers.com/writing-type-stable-julia-code/" class="external-link">Writing
type-stable Julia code</a></p>
</div>
</div>
</div>
<hr><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Type instabilities are the bane of efficient Julia</li>
<li>We can discover type instability using <code>@profview</code>, and
analyze further using <code>@code_warntype</code>.</li>
<li>Don’t use mutable global variables.</li>
<li>Write your code inside functions.</li>
<li>Specify element types for containers and structs.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="090-best-practices.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="120-allocations.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="090-best-practices.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Best practices
        </a>
        <a class="chapter-link float-end" href="120-allocations.html" rel="next">
          Next: Reducing allocations...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/100-introduction-performance.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:j.hidding@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/100-introduction-performance.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, Julia, lesson",
  "name": "Type Stability",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/100-introduction-performance.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/100-introduction-performance.html",
  "dateCreated": "2024-01-01",
  "dateModified": "2025-02-09",
  "datePublished": "2025-04-01"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

